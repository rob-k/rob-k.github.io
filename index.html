<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="CRDTdroid : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>CRDTdroid</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/rob-k">View on GitHub</a>

          <h1 id="project_title">CRDTdroid</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started</h1>

<h2>
<a id="1-include-the-framework" class="anchor" href="#1-include-the-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Include the Framework</h2>

<h3>
<a id="gradle" class="anchor" href="#gradle" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Gradle</h3>

<p>For Gradle, add this dependency to your <code>build.gradle</code> in the <code>dependencies {...}</code> section:</p>

<div class="highlight highlight-source-ini"><pre>compile <span class="pl-s"><span class="pl-pds">'</span>de.uulm.vs.android.crdtframework:crdtframework:0.3<span class="pl-pds">'</span></span></pre></div>

<p>While the repository is not available in jcenter, you also have to add the Bintray repository to your module by editing your <code>build.gradle</code>:</p>

<div class="highlight highlight-source-ini"><pre>repositories {
    maven {
        url <span class="pl-s"><span class="pl-pds">'</span>https://dl.bintray.com/rob-k/crdt-framework/<span class="pl-pds">'</span></span>
    }
}</pre></div>

<h3>
<a id="maven" class="anchor" href="#maven" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maven</h3>

<p>For Maven, add this dependency to your <code>pom.xml</code> in the <code>&lt;dependecies&gt;...&lt;/dependecies&gt;</code> section: </p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;de.uulm.vs.android.crdtframework&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;crdtframework&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;0.3&lt;/<span class="pl-ent">version</span>&gt;
  &lt;<span class="pl-ent">type</span>&gt;pom&lt;/<span class="pl-ent">type</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<p>While the repository is not available in jcenter, you also have to configure your Maven <code>settings.xml</code> file to resolve artifacts through Bintray (taken from <a href="https://bintray.com/docs/usermanual/formats/formats_mavenrepositories.html#anchorMavenResolve">the Bintray docs</a>):</p>

<div class="highlight highlight-text-xml"><pre> &lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">'</span>1.0<span class="pl-pds">'</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">'</span>UTF-8<span class="pl-pds">'</span></span>?&gt;
 &lt;<span class="pl-ent">settings</span> <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">'</span>http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd<span class="pl-pds">'</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">'</span>http://maven.apache.org/SETTINGS/1.0.0<span class="pl-pds">'</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">'</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">'</span></span>&gt;
 &lt;<span class="pl-ent">profiles</span>&gt;
    &lt;<span class="pl-ent">profile</span>&gt;
        &lt;<span class="pl-ent">repositories</span>&gt;
            &lt;<span class="pl-ent">repository</span>&gt;
                &lt;<span class="pl-ent">snapshots</span>&gt;
                    &lt;<span class="pl-ent">enabled</span>&gt;false&lt;/<span class="pl-ent">enabled</span>&gt;
                &lt;/<span class="pl-ent">snapshots</span>&gt;
                &lt;<span class="pl-ent">id</span>&gt;bintray-&lt;<span class="pl-ent">username</span>&gt;-maven&lt;/<span class="pl-ent">id</span>&gt;
                &lt;<span class="pl-ent">name</span>&gt;bintray&lt;/<span class="pl-ent">name</span>&gt;
                &lt;<span class="pl-ent">url</span>&gt;https://dl.bintray.com/jaycroaker/maven&lt;/<span class="pl-ent">url</span>&gt;
            &lt;/<span class="pl-ent">repository</span>&gt;
        &lt;/<span class="pl-ent">repositories</span>&gt;
        &lt;<span class="pl-ent">pluginRepositories</span>&gt;
            &lt;<span class="pl-ent">pluginRepository</span>&gt;
                &lt;<span class="pl-ent">snapshots</span>&gt;
                    &lt;<span class="pl-ent">enabled</span>&gt;false&lt;/<span class="pl-ent">enabled</span>&gt;
                &lt;/<span class="pl-ent">snapshots</span>&gt;
                &lt;<span class="pl-ent">id</span>&gt;bintray-&lt;<span class="pl-ent">username</span>&gt;-maven&lt;/<span class="pl-ent">id</span>&gt;
                &lt;<span class="pl-ent">name</span>&gt;bintray-plugins&lt;/<span class="pl-ent">name</span>&gt;
                &lt;<span class="pl-ent">url</span>&gt;https://dl.bintray.com/jaycroaker/maven&lt;/<span class="pl-ent">url</span>&gt;
            &lt;/<span class="pl-ent">pluginRepository</span>&gt;
        &lt;/<span class="pl-ent">pluginRepositories</span>&gt;
        &lt;<span class="pl-ent">id</span>&gt;bintray&lt;/<span class="pl-ent">id</span>&gt;
    &lt;/<span class="pl-ent">profile</span>&gt;
 &lt;/<span class="pl-ent">profiles</span>&gt;
 &lt;<span class="pl-ent">activeProfiles</span>&gt;
    &lt;<span class="pl-ent">activeProfile</span>&gt;bintray&lt;/<span class="pl-ent">activeProfile</span>&gt;
 &lt;/<span class="pl-ent">activeProfiles</span>&gt;
 &lt;/<span class="pl-ent">settings</span>&gt;</pre></div>

<h2>
<a id="2-require-permissions" class="anchor" href="#2-require-permissions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Require Permissions</h2>

<p>Add the following lines to your <code>AndroidManifest.xml</code> to make your app ask for the required permissions.</p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">manifest</span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">android</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.android.com/apk/res/android<span class="pl-pds">"</span></span>
    <span class="pl-e">package</span>=<span class="pl-s"><span class="pl-pds">"</span>de.uulm.vs.android.fitshare<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">versionCode</span>=<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">versionName</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span> &gt;

    ...

    <span class="pl-c">&lt;!-- Add these lines if you want to support Wi-Fi P2P (recommended): --&gt;</span>
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_WIFI_STATE<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.CHANGE_WIFI_STATE<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.CHANGE_NETWORK_STATE<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.INTERNET<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_NETWORK_STATE<span class="pl-pds">"</span></span> /&gt;

    <span class="pl-c">&lt;!-- Add these lines if you want to support Bluetooth (optional): --&gt;</span>
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH<span class="pl-pds">"</span></span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">required</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>/&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH_ADMIN<span class="pl-pds">"</span></span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">required</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>/&gt;

    ...

&lt;/<span class="pl-ent">manifest</span>&gt;</pre></div>

<h2>
<a id="3-create-a-crdtcontroller-and-connectionhandler-and-hook-them-up" class="anchor" href="#3-create-a-crdtcontroller-and-connectionhandler-and-hook-them-up" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. Create a CRDTController and ConnectionHandler and hook them up</h2>

<p>You can do this in the <code>onCreate()</code> method of either one of your <code>Activity</code>s or, preferably, in your <code>Application</code>.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">/* The CRDTController instance to handle CRDTs */</span>
<span class="pl-k">public</span> <span class="pl-smi">CRDTController</span> crdtController;

<span class="pl-c">/* The connection handler to handle connections with other devices */</span>
<span class="pl-k">public</span> <span class="pl-smi">ExchangeConnectionHandler</span> wifip2pConnectionHandler;

<span class="pl-c">/* A randomly generated UUID for this application */</span>
<span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-smi">String</span> <span class="pl-c1">APP_UUID</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>45007ff6-f627-44f7-afa1-fe9010ae8a6e<span class="pl-pds">"</span></span>;

<span class="pl-k">@Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onCreate() {

    <span class="pl-k">if</span> (<span class="pl-v">this</span><span class="pl-k">.</span>crdtController <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
        <span class="pl-c">// Create a new CRDT changeListener to handle the CRDTs</span>
        <span class="pl-v">this</span><span class="pl-k">.</span>crdtController <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">CRDTController</span>(<span class="pl-v">this</span>);
        crdtController<span class="pl-k">.</span>enableToasts(<span class="pl-c1">true</span>);
    }

    <span class="pl-k">if</span> (<span class="pl-v">this</span><span class="pl-k">.</span>wifip2pConnectionHandler <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
        <span class="pl-c">// Create a new WiFiDirectBroadcastReceiver to handle WiFiP2P connections</span>
        <span class="pl-v">this</span><span class="pl-k">.</span>wifip2pConnectionHandler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">WiFiDirectBroadcastReceiver</span>(<span class="pl-v">this</span>, <span class="pl-c1">APP_UUID</span>, crdtController<span class="pl-k">.</span>getClientId(),
                <span class="pl-v">this</span><span class="pl-k">.</span>crdtController);
        crdtController<span class="pl-k">.</span>addConnectionHandler(wifip2pConnectionHandler);
    }

    <span class="pl-c">// Initially start device discovery and every 60 seconds after</span>
    crdtController<span class="pl-k">.</span>startScheduledDiscovery(<span class="pl-c1">60</span>);

    <span class="pl-v">super</span><span class="pl-k">.</span>onCreate();
}</pre></div>

<h2>
<a id="4-make-the-app-register-and-unregister-the-broadcastreceivers-and-save-the-data-of-the-crdt-framework-to-the-device-storage" class="anchor" href="#4-make-the-app-register-and-unregister-the-broadcastreceivers-and-save-the-data-of-the-crdt-framework-to-the-device-storage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. Make the App register and unregister the BroadcastReceivers and save the data of the CRDT-Framework to the device storage</h2>

<p>This should be done in the <code>onResume()</code> and <code>onPause()</code> methods of your <code>Activity</code>s. It is recommended to outsource this code in a a method that will be called in all activities if you have more than one activity.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">/**</span>
<span class="pl-c"> * Registers the broadcast receivers with the intent values to be matched.</span>
<span class="pl-c"> * Can be called by activities as default implementation for</span>
<span class="pl-c"> * {@link android.app.Activity#onResume()}.</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onResume() {
    crdtController<span class="pl-k">.</span>registerReceivers();
}

<span class="pl-c">/**</span>
<span class="pl-c"> * Unregisters the broadcast receivers and makes the CRDTController save its data to the device storage.</span>
<span class="pl-c"> * Can be called by activities as default implementation for {@link android.app.Activity#onPause()}.</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onPause() {
    crdtController<span class="pl-k">.</span>unregisterReceivers();

    <span class="pl-c">// Save the data to the device storage</span>
    crdtController<span class="pl-k">.</span>saveToStorage();
}</pre></div>

<h2>
<a id="5-get-a-crdt-instance" class="anchor" href="#5-get-a-crdt-instance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>5. Get a CRDT-Instance</h2>

<p>To get instances of new CRDTs call the <code>newXXXCRDT(id, ...)</code> methods of your <code>CRDT-Controller</code> instance. The <code>id</code> is a <code>String</code> that functions as identifier for the instance.</p>

<p>To get back instances that have been created previously (for example in another activity or previous to an application shutdown), call <code>getCRDT(id)</code>.</p>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example:</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-c1">...</span>
<span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-smi">String</span> <span class="pl-c1">COUNTER_CRDT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>counterCRDT<span class="pl-pds">"</span></span>;
<span class="pl-k">private</span> <span class="pl-smi">CounterCRDT</span> counterCRDT;

<span class="pl-k">@Override</span>
<span class="pl-k">protected</span> <span class="pl-k">void</span> onCreate(<span class="pl-smi">Bundle</span> savedInstanceState) {

    <span class="pl-c1">...</span>

    <span class="pl-k">if</span> ((counterCRDT <span class="pl-k">=</span> (<span class="pl-smi">CounterCRDT</span>) crdtController
            .getCRDT(<span class="pl-c1">COUNTER_CRDT</span>)) <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
        counterCRDT <span class="pl-k">=</span> crdtController<span class="pl-k">.</span>newCounterCRDT(<span class="pl-c1">COUNTER_CRDT</span>, <span class="pl-c1">0</span>);
    }

    <span class="pl-c1">...</span>

}</pre></div>

<h2>
<a id="6-interact-with-the-controller" class="anchor" href="#6-interact-with-the-controller" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>6. Interact with the Controller</h2>

<h3>
<a id="start-discovery" class="anchor" href="#start-discovery" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start discovery</h3>

<p>Discovery of other devices (for all registered connection handlers) can be be initiated manually by calling <code>startDiscovery()</code>, or automatically every X seconds by using <code>startScheduledDiscovery(X)</code> after the controller has been initiated.</p>

<h3>
<a id="commit-changes" class="anchor" href="#commit-changes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Commit changes</h3>

<p>Changes from other devices will be received on contact. However, if a connection to one or more devices is already existent, your changes can be commited to be sent over this connection immediately with <code>commitChanges()</code>. This will attempt to push on all registered connection handlers.</p>

<h3>
<a id="receive-notifications" class="anchor" href="#receive-notifications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Receive notifications</h3>

<p>You can add one or more listeners in order to receive notifcations about changes to the framework. This listeners must implement the <code>CRDTNotificationReceiver</code> interface and can be added with <code>crdtController.addListener(listener);</code>. Notifications include successful merges, replication start and end, as well as errors. Additionally, information about available peers for both Bluetooth and Wi-Fi P2P and the respective states of these frameworks can be received.</p>

<h3>
<a id="transactions" class="anchor" href="#transactions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Transactions</h3>

<p>You can group a set of changes to your CRDTs or simply delay the merge of received and local changes by using a transaction.</p>

<h4>
<a id="start-a-transaction" class="anchor" href="#start-a-transaction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start a transaction</h4>

<p>Call the <code>beginTransaction()</code> method of your <code>CRDT-Controller</code> instance. After this call the framework will use a deep copy of your CRDTs on contact with other devices and received changes will be queued till the transaction is finished. Calling <code>commitChanges()</code> while a transaction is active will result in an error.</p>

<h4>
<a id="rollback-the-transaction" class="anchor" href="#rollback-the-transaction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rollback the transaction</h4>

<p>Call <code>rollbackTransaction()</code> if you want to revert all changes that have been made within the transaction. All queued changes will be merged now.</p>

<h4>
<a id="commit-the-transaction" class="anchor" href="#commit-the-transaction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Commit the transaction</h4>

<p>Call <code>commitTransaction()</code> to finish a transaction. This will automatically call <code>commitChanges()</code> and all queued changes will be merged.</p>

<h2>
<a id="javadoc" class="anchor" href="#javadoc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JavaDoc</h2>

<p><a href="/javadoc">javadoc</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
